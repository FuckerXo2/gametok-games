<!DOCTYPE html> 

<html>
<head>
  <title>Javascript Racer</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link href="common.css" rel="stylesheet" type="text/css" />
  <style>
    /* GameTok fullscreen and mobile fixes */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { 
      width: 100%; height: 100%; 
      overflow: hidden; 
      touch-action: none;
      background: #72D7EE;
    }
    #controls, #instructions, #mute, #fps { display: none !important; }
    #racer { width: 100%; height: 100%; position: relative; }
    #canvas { 
      width: 100% !important; 
      height: 100% !important; 
      position: absolute !important;
      top: 0; left: 0;
    }
    #hud {
      position: fixed !important;
      top: 60px !important;
      left: 10px !important;
      right: 10px !important;
      z-index: 10;
      display: flex;
      justify-content: space-between;
      pointer-events: none;
    }
    .hud {
      background: rgba(0,0,0,0.5);
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 14px;
      color: white;
    }
    #last_lap_time, #fast_lap_time { display: none; }
    
    /* Touch controls */
    #touch-controls {
      position: fixed;
      bottom: 100px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      padding: 0 20px;
      z-index: 100;
      pointer-events: none;
    }
    .touch-btn {
      width: 70px;
      height: 70px;
      background: rgba(255,255,255,0.3);
      border: 2px solid rgba(255,255,255,0.5);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      color: white;
      pointer-events: auto;
      user-select: none;
      -webkit-user-select: none;
    }
    .touch-btn:active { background: rgba(255,255,255,0.5); }
    #gas-btn { 
      position: fixed;
      bottom: 100px;
      right: 20px;
      width: 80px;
      height: 80px;
      background: rgba(0,200,0,0.4);
      border-color: rgba(0,255,0,0.6);
    }
  </style>
</head> 

<body> 

  <table id="controls" style="display:none">
    <tr>
      <td colspan="2">
        <a href='v1.straight.html'>straight</a> |
        <a href='v2.curves.html'>curves</a>     |
        <a href='v3.hills.html'>hills</a>       |
        <a href='v4.final.html'>final</a>
      </td>
    </tr>
    <tr><td id="fps" colspan="2" align="right"></td></tr>
    <tr>
      <th><label for="resolution">Resolution :</label></th>
      <td>
        <select id="resolution" style="width:100%">
          <option selected value='fine'>Fine (1280x960)</option>
          <option value='high'>High (1024x768)</option>
          <option value='medium'>Medium (640x480)</option>
          <option value='low'>Low (480x360)</option>
        </select>
      </td>
    </tr>
    <tr>
      <th><label for="lanes">Lanes :</label></th>
      <td>
        <select id="lanes">
          <option>1</option>
          <option>2</option>
          <option selected>3</option>
          <option>4</option>
        </select>
      </td>
    </tr>
    <tr>
      <th><label for="roadWidth">Road Width (<span id="currentRoadWidth"></span>) :</label></th>
      <td><input id="roadWidth" type='range' min='500' max='3000' title="integer (500-3000)"></td>
    </tr>
    <tr>
      <th><label for="cameraHeight">CameraHeight (<span id="currentCameraHeight"></span>) :</label></th>
      <td><input id="cameraHeight" type='range' min='500' max='5000' title="integer (500-5000)"></td>
    </tr>
    <tr>
      <th><label for="drawDistance">Draw Distance (<span id="currentDrawDistance"></span>) :</label></th>
      <td><input id="drawDistance" type='range' min='100' max='500' title="integer (100-500)"></td>
    </tr>
    <tr>
      <th><label for="fieldOfView">Field of View (<span id="currentFieldOfView"></span>) :</label></th>
      <td><input id="fieldOfView" type='range' min='80' max='140' title="integer (80-140)"></td>
    </tr>
    <tr>
      <th><label for="fogDensity">Fog Density (<span id="currentFogDensity"></span>) :</label></th>
      <td><input id="fogDensity" type='range' min='0' max='50' title="integer (0-50)"></td>
    </tr>
  </table>

  <div id='instructions' style="display:none">
    <p>Use the <b>arrow keys</b> to drive the car.</p>
  </div>

  <div id="racer">
    <div id="hud" style="width:100%;position:fixed;left:0;top:0;right:0">
      <span id="speed"            class="hud"><span id="speed_value" class="value">0</span> mph</span>
      <span id="current_lap_time" class="hud">Time: <span id="current_lap_time_value" class="value">0.0</span></span> 
      <span id="last_lap_time"    class="hud">Last Lap: <span id="last_lap_time_value" class="value">0.0</span></span>
      <span id="fast_lap_time"    class="hud">Fastest Lap: <span id="fast_lap_time_value" class="value">0.0</span></span>
    </div>
    <canvas id="canvas" style="width:100%;height:100%;position:fixed;left:0;top:0;right:0;bottom:0">
      Sorry, this example cannot be run because your browser does not support the &lt;canvas&gt; element
    </canvas>
    Loading...
  </div>

  <audio id='music'>
    <source src="music/racer.ogg">
    <source src="music/racer.mp3">
  </audio>
  <span id="mute" style="display:none"></span>

  <script src="js/stats.js"></script>
  <script src="js/common.js"></script>
  <script src="js/main.js"></script>
  
  <!-- Touch controls -->
  <div id="touch-controls">
    <div class="touch-btn" id="left-btn">◀</div>
    <div class="touch-btn" id="right-btn">▶</div>
  </div>
  <div class="touch-btn" id="gas-btn">▲</div>
  
  <script>
    // Touch controls
    var leftBtn = document.getElementById('left-btn');
    var rightBtn = document.getElementById('right-btn');
    var gasBtn = document.getElementById('gas-btn');
    
    function simulateKey(keyCode, isDown) {
      var event = new KeyboardEvent(isDown ? 'keydown' : 'keyup', { keyCode: keyCode, which: keyCode });
      document.dispatchEvent(event);
    }
    
    // Left button
    leftBtn.addEventListener('touchstart', function(e) { e.preventDefault(); simulateKey(37, true); }, {passive: false});
    leftBtn.addEventListener('touchend', function(e) { e.preventDefault(); simulateKey(37, false); }, {passive: false});
    
    // Right button  
    rightBtn.addEventListener('touchstart', function(e) { e.preventDefault(); simulateKey(39, true); }, {passive: false});
    rightBtn.addEventListener('touchend', function(e) { e.preventDefault(); simulateKey(39, false); }, {passive: false});
    
    // Gas button
    gasBtn.addEventListener('touchstart', function(e) { e.preventDefault(); simulateKey(38, true); }, {passive: false});
    gasBtn.addEventListener('touchend', function(e) { e.preventDefault(); simulateKey(38, false); }, {passive: false});
    
    // Expose startGame for GameTok
    window.startGame = function() {
      // Game auto-starts, nothing needed
    };
  </script>

</body> 
</html>
